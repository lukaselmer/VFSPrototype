\documentclass[a4paper,12pt]{article}


% add more packages if necessary
\usepackage{xspace}
%\usepackage{graphicx}
%\usepackage{xcolor}
%\usepackage{hyperref}


% TODO: Add your group name
\newcommand{\groupname}{jcd\_dumplings\xspace}


\title{
Project Report \\ 
Group \groupname \\
\vspace{5mm}
\large Java and C\# in depth, Spring 2013
}
\author{
% TODO: Add your names here
Elmer Lukas \\
Ma Hua \\
Nussbaumer Ivo
}
\date{\today}



\begin{document}
\maketitle

\section{Introduction}

This document describes the design and implementation of the \emph{Personal Virtual File System} of group \emph{\groupname}. The project is part of the course \emph{Java and C\# in depth} at ETH Zurich. The following sections describe each project phase, listing the requirements that were implemented and the design decisions taken. The last section describes a use case of using the \emph{Personal Virtual File System}.

% PART I: VFS CORE
% --------------------------------------

\section{VFS Core}

% TODO: Remove this line
\textbf{[This section has to be completed by April 8th.]}

%TODO: Remove this text and replace it with actual content
\emph{Give a short description (1-2 paragraphs) of what VFS Core is.}


\subsection{Requirements}

% TODO: Remove this text and replace it with actual content
\emph{Describe which requirements (and possibly bonus requirements) you have implemented in this part. Give a quick description (1-2 sentences) of each requirement. List the software elements (classes and or functions) that are mainly involved in implementing each requirement.}


\subsection{Design}

% TODO: Remove this text and replace it with actual content
\emph{Give an overview of the design of this part and describe in general terms how the implementation works. You can mention design patterns used, class diagrams, definition of custom file formats, network protocols, or anything else that helps understand the implementation.}

\subsection{File Format}

The design of the file format is related to the Unix File System (UFS) and the New Technology File System (NTFS). The file is partitioned into two sections (reference / citation needed):

\begin{itemize}
  \item one super block
  \item many normal blocks
\end{itemize}

\subsubsection{Super block}

The super block has a constant size of 1 MB. Altough most of the space is not needed yet, it can be used to save meta information about the file system (e.g. version, date created, block size, compression algorithm,
file encryption algorithm, seed for file encryption, etc.).

\subsubsection{Normal blocks}

The normal blocks consist of many blocks of a fixed block size. The block size is stored in the file system meta information, which is stored in the super block. The block size is the same for every block and cannot be changed after creating the file. Tough it is possible to change the block amount, which is known as growing or shrinking the virtual file.\\

One normal block can be of one of the following types:

\begin{itemize}
  \item Index Node
  \item Indirect Node
  \item File content
\end{itemize}


The Index Node contains the file type (file or directory, 1 byte) and the name (max. 255 bytes, can contain any character excluding "/") of one object.\\

Iff the file type is file, then there are two possibilities:

\begin{enumerate}
  \item Small file content\\
  The content of the file is very small (block size minus 1 type byte and 255 name bytes) and can be stored in the index node. Then the content of the file is stored in this very Index Node.
  \item Large file content\\
The content of the file exceeds the block size (minus the type byte and the name bytes = 256 bytes).\\
Each reference to a file content block (description of file content block: see below) is of size 2 \^ (block reference size, n=8, TBD), which allows maximum virtual file sizes of 2 \^ (block reference size, n=8, TBD) * block size + super block size.\\
Then the first (n=10, TBD) block references directly refer to file content blocks. This is (n=10, TBD) * (block reference size, n=8, TBD) bytes of size.\\
Single inderection: The next "block reference" references to one indirect node, which reference to (block size / (block reference size, n=8, TBD)) oher file content blocks each.\\
Double indirection: The next "block reference" references to one inderect node, which reference to (block size / (block reference size, n=8, TBD)) indirect nodes each, which refernce to (block size / (block reference size, n=8, TBD)) other file contents each.\\
Triple indirection: The next "block reference" references to one inderect node, which reference to (block size / (block reference size, n=8, TBD)) indirect nodes each, which reference to (block size / (block reference size, n=8, TBD)) indirect nodes each, which refernce to (block size / (block reference size, n=8, TBD)) other file contents each.\\
\emph{Note: the rest of the file should contain the fibonacci numbers (just kidding)...}\\
\end{enumerate}

In total, this gives a maximum file size of\\
$(block size / (block reference size, n=8, TBD))^{3} +$\\
$(block size / (block reference size, n=8, TBD))^{2} +$\\
$(block size / (block reference size, n=8, TBD)) + $\\
$(n=10, TBD)) * block size$.

Iff the file type is a directory, than the Index Node contains the references to the objects (files or directory). If the amount of directories is smaller or equal to (block size - 256 bytes) / (block reference size, n=8, TBD), 
then all references are stored in that file. Otherwise, it works like the large files with Indirect Nodes.

The block size
Because of the type and the name (= 1 byte + 255 bytes), the block size must be larger than 256 bytes. In general, there is no good block size tough. If very many small files are stored and the block size is chosen 
large (e.g. 32 KB), than there are huge losses because of the internal fragmentation (the rest of the block is unused). If the files are very large, the overhead to manage of the data is huge, especially if the
block size is very small (e.g. 512 bytes). So if rather few large files are stored in the VFS, the block size should be large, and if many small files are stored, the block size should be small. A good compromise is
a block size of 2-8 KB (further literature/ links / reasoning / calculations / proofs required for these statements).

\subsection{Block Allocation}

In this project, the blocks are allocated from the beginning of the file system to the end of the file system. The system has a pointer to the next free block when running. If a block is used for an object, this pointer is moved
to the next free block in the file system. This can end up using O(n) time to find a free block, which is suboptimal. If a block is deleted,
this pointer is not moved back to the free block. This can lead to external fragmentation, but partly prevents internal fragmentation (further literature/ links / reasoning / calculations / 
proofs required for these statements). If the pointer points to the last block of the file system and this block is reserved, but there is still free space in the file system, the pointer is moved back to the beginning.

\subsection{Index / Indices}

Due to the simplicity of the block allocation, there is no need to store an index of free blocks.

For the filename search, it would be convenient if the file names were stored in an ordered list. This could be achieved by storing the names in an AVL tree (citiation / source needed here). This would enable the file system to
find a file name in O(log(n)) time instead of O(n). Due to the complexity, this is not implemented (yet).





% PART II: VFS Browser
% --------------------------------------

\section{VFS Browser}

% TODO: Remove this line
\textbf{[This section has to be completed by April 22nd.]}

%TODO: Remove this text and replace it with actual content
\emph{Give a short (1-2 paragraphs) description of what VFS Browser is.}


\subsection{Requirements}

% TODO: Remove this text and replace it with actual content
\emph{Describe which requirements (and possibly bonus requirements) you have implemented in this part. Give a quick description (1-2 sentences) of each requirement. List the software elements (classes and or functions) that are mainly involved in implementing each requirement.}


\subsection{Design}

% TODO: Remove this text and replace it with actual content
\emph{Give an overview of the design of this part and describe in general terms how the implementation works. You can mention design patterns used, class diagrams, definition of custom file formats, network protocols, or anything else that helps understand the implementation.}


\subsection{Integration}

% TODO: Remove this text and replace it with actual content
\emph{If you had to change the design or API of the previous part, describe the changes and the reasons for each change here.}



% PART III: Synchronization Server
% --------------------------------------

\section{Synchronization Server}

% TODO: Remove this line
\textbf{[This section has to be completed by May 13th.]}

%TODO: Remove this text and replace it with actual content
\emph{Give a short (1-2 paragraphs) description of what VFS Browser is.}


\subsection{Requirements}

% TODO: Remove this text and replace it with actual content
\emph{Describe which requirements (and possibly bonus requirements) you have implemented in this part. Give a quick description (1-2 sentences) of each requirement. List the software elements (classes and or functions) that are mainly involved in implementing each requirement.}


\subsection{Design}

% TODO: Remove this text and replace it with actual content
\emph{Give an overview of the design of this part and describe in general terms how the implementation works. You can mention design patterns used, class diagrams, definition of custom file formats, network protocols, or anything else that helps understand the implementation.}


\subsection{Integration}

% TODO: Remove this text and replace it with actual content
\emph{If you had to change the design or API of the previous part, describe the changes and the reasons for each change here.}



% PART IV: Quick Start Guide
% --------------------------------------

\section{Quick Start Guide}

% TODO: Remove this line
\textbf{[optional: This part has to be completed by April 8th.]}

% TODO: Remove this text and replace it with actual content
\emph{If you have a command line interface for your VFS, describe here the commands available (e.g. ls, copy, import).} \\ \\ \\


% TODO: Remove this line
\noindent\textbf{[This part has to be completed by May 13th.]}

% TODO: Remove this text and replace it with actual content
\emph{Describe how to realize the following use case with your system. Describe the steps involved and how to perform each action (e.g. command line executions and arguments, menu entries, keyboard shortcuts, screenshots). The use case is the following:
\begin{enumerate}
\item Start synchronization server on localhost.
\item Create account on synchronization server.
\item Create two VFS disks (on the same machine) and link them to the new account.
\item Import a directory (recursively) from the host file system into Disk 1.
\item Dispose Disk 1 after the synchronization finished.
\item Export the directory (recursively) from Disk 2 into the host file system.
\item Stop synchronization server.
\end{enumerate}
}


\end{document}
